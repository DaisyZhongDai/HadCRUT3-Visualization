<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Yo Mama's New Favorite Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.20.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #map-overlay{ position: absolute; top: 0; bottom:0; width: 100%; height: 100%; z-index: 10; background-color: blue; opacity: 0.7; pointer-events: none;}
    </style>

    <script   src="https://code.jquery.com/jquery-3.0.0.min.js"   integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="   crossorigin="anonymous"></script>
</head>
<body>
<div id='map'></div>
<div id='map-overlay'></div>

<script src="temp-anomaly.js"></script>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoidGVvbWFuZGF2aWQiLCJhIjoiY2lwaHBrNnp4MDE2Z3RsbmpxeWVkbXhxMSJ9.rhKrjQ0Eb8iH0inNPQ7W8Q';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/teomandavid/ciqbmy8mh0001khmcg5jkce1l',
    zoom: 3,
    minZoom: 3,
    maxZoom: 9,
    center: [5.425411010332567, 51.22556912180988]
});

var overlayLayer = {
    'id': 'overlay',
    'source': 'overlay',
    'source-layer': 'admin',
    'type': 'line'
};

var year = 1990;
function iterate(){
    year++;
    if(year >= 2010){
      year = 1990;
    }
    map.setFilter('raw-temperatures', ['==', 'start', year]);
    var anomaly = tempAnomaly[year];
    var percentRed = (1-anomaly)/2;
    var percentBlue = 1-percentRed;
    var red = Math.round(percentRed * 255);
    var blue = Math.round(percentBlue * 255);
    $('#map-overlay').css('background-color',"rgb(" + red + ",0," + blue +")");
}

map.on('load', function () {
    map.setPaintProperty('raw-temperatures', 'circle-color', {
              property: "temp",
              type: 'exponential',
              stops: [
                  [-20, '#0000ff'],
                  [50 , '#ff0000']
              ]
    });
    map.setPaintProperty('raw-temperatures', 'circle-radius', {
      stops: [[2,5],[9,25]]
    });

    map.setFilter('raw-temperatures', ['==', 'start', 1990]);

    setInterval(iterate, 1000);
});

</script>

</body>
</html>
